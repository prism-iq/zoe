<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ZOE - &#950;&#969;&#942; - Where Programs Live</title>
  <meta name="description" content="ZOE - Pantheon public interface. Where programs live.">
  <meta name="theme-color" content="#0a0a0a">
  <style>
    /* === RESET & BASE === */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0a0a0a;
      --surface: #111114;
      --border: #1a1a2e;
      --text: #c8c8d0;
      --text-dim: #666680;
      --accent: #0ff;
      --accent-glow: rgba(0, 255, 255, 0.15);
      --danger: #f44;
      --success: #0f8;
      --warn: #fa0;
      --phi: 1.618033988749895;
      --radius: 6px;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', monospace;
      font-size: 14px;
      line-height: 1.618;
      min-height: 100vh;
      overflow-x: hidden;
    }

    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* === PHI-BREATHING ANIMATION === */
    @keyframes phi-breathe {
      0%   { transform: scale(1); opacity: 0.8; }
      50%  { transform: scale(1.0618); opacity: 1; }
      100% { transform: scale(1); opacity: 0.8; }
    }

    .phi-breathe {
      animation: phi-breathe 1.618s ease-in-out infinite;
    }

    @keyframes pulse-ring {
      0%   { transform: scale(0.8); opacity: 0.6; }
      50%  { transform: scale(1.2); opacity: 0; }
      100% { transform: scale(0.8); opacity: 0; }
    }

    @keyframes fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* === LAYOUT === */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    /* === HEADER === */
    header {
      text-align: center;
      padding: 3rem 0 2rem;
      position: relative;
    }

    header h1 {
      font-size: 2.4rem;
      font-weight: 300;
      letter-spacing: 0.3em;
      color: var(--accent);
      text-shadow: 0 0 30px var(--accent-glow);
    }

    header .subtitle {
      color: var(--text-dim);
      font-size: 0.85rem;
      margin-top: 0.5rem;
      letter-spacing: 0.15em;
    }

    .header-orb {
      width: 12px;
      height: 12px;
      background: var(--accent);
      border-radius: 50%;
      margin: 1.2rem auto 0;
      box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent-glow);
    }

    /* === STATS BAR === */
    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 2.5rem;
      padding: 1rem 0;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border);
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.6rem;
      font-weight: 600;
      color: var(--accent);
    }

    .stat-label {
      font-size: 0.7rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* === GRID === */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
    }

    /* === PANEL === */
    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      animation: fade-in 0.6s ease-out both;
    }

    .panel-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    /* === DAEMON CARDS === */
    .daemon-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .daemon-card {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: border-color 0.3s;
    }

    .daemon-card:hover {
      border-color: var(--accent);
    }

    .daemon-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .daemon-dot.up { background: var(--success); box-shadow: 0 0 8px var(--success); }
    .daemon-dot.down { background: var(--danger); box-shadow: 0 0 8px var(--danger); }
    .daemon-dot.unknown { background: var(--text-dim); }

    .daemon-info { flex: 1; min-width: 0; }

    .daemon-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text);
    }

    .daemon-port {
      font-size: 0.7rem;
      color: var(--text-dim);
    }

    .daemon-status {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .daemon-status.up { color: var(--success); }
    .daemon-status.down { color: var(--danger); }
    .daemon-status.unknown { color: var(--text-dim); }

    /* === KNOWLEDGE PANEL === */
    .knowledge-list {
      list-style: none;
    }

    .knowledge-list li {
      display: flex;
      justify-content: space-between;
      padding: 0.4rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      font-size: 0.85rem;
    }

    .knowledge-list li:last-child { border-bottom: none; }

    .knowledge-list .k-label { color: var(--text-dim); }
    .knowledge-list .k-value { color: var(--accent); font-weight: 500; }

    /* === CHAT SECTION === */
    .chat-section {
      grid-column: 1 / -1;
    }

    .chat-messages {
      height: 260px;
      overflow-y: auto;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.85rem;
    }

    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-track { background: transparent; }
    .chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .msg {
      padding: 0.35rem 0;
      line-height: 1.5;
    }

    .msg .sender {
      font-weight: 600;
      margin-right: 0.5rem;
    }

    .msg .sender.user { color: var(--accent); }
    .msg .sender.zoe { color: var(--success); }
    .msg .sender.system { color: var(--text-dim); }

    .chat-input-row {
      display: flex;
      gap: 0.75rem;
    }

    .chat-input-row textarea {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-family: inherit;
      font-size: 0.85rem;
      padding: 0.65rem 0.85rem;
      resize: none;
      height: 44px;
      outline: none;
      transition: border-color 0.2s;
    }

    .chat-input-row textarea:focus {
      border-color: var(--accent);
    }

    .chat-input-row button {
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
      border-radius: var(--radius);
      padding: 0 1.5rem;
      font-family: inherit;
      font-size: 0.8rem;
      cursor: pointer;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      transition: background 0.2s, color 0.2s;
    }

    .chat-input-row button:hover {
      background: var(--accent);
      color: var(--bg);
    }

    /* === FOOTER === */
    footer {
      text-align: center;
      padding: 2rem 0 1.5rem;
      color: var(--text-dim);
      font-size: 0.7rem;
      letter-spacing: 0.1em;
    }

    footer .phi-symbol {
      color: var(--accent);
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <div class="container">

    <!-- HEADER -->
    <header>
      <h1>ZOE</h1>
      <div class="subtitle">&zeta;&omega;&eta; &mdash; Where Programs Live</div>
      <div class="header-orb phi-breathe"></div>
    </header>

    <!-- STATS BAR -->
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value" id="stat-daemons">--</div>
        <div class="stat-label">Daemons Alive</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="stat-papers">--</div>
        <div class="stat-label">Papers</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="stat-uptime">--</div>
        <div class="stat-label">Uptime (s)</div>
      </div>
    </div>

    <!-- MAIN GRID -->
    <div class="grid">

      <!-- DAEMON STATUS -->
      <div class="panel" style="animation-delay: 0.1s">
        <div class="panel-title">Pantheon Daemons</div>
        <div class="daemon-grid" id="daemon-grid">
          <!-- populated by JS -->
        </div>
      </div>

      <!-- KNOWLEDGE -->
      <div class="panel" style="animation-delay: 0.2s">
        <div class="panel-title">Knowledge</div>
        <ul class="knowledge-list" id="knowledge-list">
          <li><span class="k-label">Papers indexed</span><span class="k-value" id="k-papers">--</span></li>
          <li><span class="k-label">Active daemons</span><span class="k-value" id="k-daemons">--</span></li>
          <li><span class="k-label">Server uptime</span><span class="k-value" id="k-uptime">--</span></li>
          <li><span class="k-label">Phi constant</span><span class="k-value">1.618033</span></li>
          <li><span class="k-label">Network</span><span class="k-value">local</span></li>
        </ul>
      </div>

      <!-- CHAT -->
      <div class="panel chat-section" style="animation-delay: 0.3s">
        <div class="panel-title">Chat &mdash; Cipher Interface</div>
        <div class="chat-messages" id="chat-messages">
          <div class="msg"><span class="sender system">[system]</span>ZOE interface ready. Type a message to reach Cipher.</div>
        </div>
        <div class="chat-input-row">
          <textarea id="chat-input" placeholder="speak..." rows="1"></textarea>
          <button id="chat-send">Send</button>
        </div>
      </div>

    </div>

    <footer>
      <span class="phi-symbol">&phi;</span> = 1.618033988749895 &middot; le code est po&eacute;sie
    </footer>

  </div>

  <script>
    /* === ZOE CLIENT === */
    (function () {
      const PHI = 1.618033988749895;

      // --- DOM refs ---
      const daemonGrid    = document.getElementById('daemon-grid');
      const chatMessages  = document.getElementById('chat-messages');
      const chatInput     = document.getElementById('chat-input');
      const chatSend      = document.getElementById('chat-send');

      // --- Fetch daemon status ---
      async function fetchStatus() {
        try {
          const res = await fetch('/api/status');
          const data = await res.json();
          renderDaemons(data.pantheon);
          document.getElementById('stat-daemons').textContent = data.summary.alive;
        } catch (e) {
          console.warn('[ZOE] status fetch failed:', e);
        }
      }

      // --- Fetch stats ---
      async function fetchStats() {
        try {
          const res = await fetch('/api/stats');
          const data = await res.json();
          document.getElementById('stat-papers').textContent = data.papers;
          document.getElementById('stat-uptime').textContent = data.uptime;
          document.getElementById('k-papers').textContent = data.papers;
          document.getElementById('k-daemons').textContent = data.daemons;
          document.getElementById('k-uptime').textContent = data.uptime + 's';
        } catch (e) {
          console.warn('[ZOE] stats fetch failed:', e);
        }
      }

      // --- Render daemon cards ---
      function renderDaemons(daemons) {
        daemonGrid.innerHTML = '';
        daemons.forEach(d => {
          const card = document.createElement('div');
          card.className = 'daemon-card';
          const st = d.status === 'up' ? 'up' : 'down';
          card.innerHTML = `
            <div class="daemon-dot ${st}"></div>
            <div class="daemon-info">
              <div class="daemon-name">${d.name}</div>
              <div class="daemon-port">:${d.port}</div>
            </div>
            <div class="daemon-status ${st}">${st}</div>
          `;
          daemonGrid.appendChild(card);
        });
      }

      // --- Chat ---
      function appendMsg(sender, text) {
        const div = document.createElement('div');
        div.className = 'msg';
        div.innerHTML = `<span class="sender ${sender}">[${sender}]</span>${escapeHtml(text)}`;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function escapeHtml(str) {
        const d = document.createElement('div');
        d.textContent = str;
        return d.innerHTML;
      }

      async function sendChat() {
        const text = chatInput.value.trim();
        if (!text) return;
        chatInput.value = '';
        appendMsg('user', text);

        try {
          const res = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
          });
          const data = await res.json();
          if (data.error) {
            appendMsg('system', data.error);
          } else {
            appendMsg('zoe', data.response || JSON.stringify(data));
          }
        } catch (e) {
          appendMsg('system', 'cipher unreachable - daemon offline');
        }
      }

      chatSend.addEventListener('click', sendChat);
      chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendChat();
        }
      });

      // --- Init ---
      fetchStatus();
      fetchStats();

      // Refresh every phi * 10 seconds
      setInterval(fetchStatus, Math.round(PHI * 10 * 1000));
      setInterval(fetchStats, Math.round(PHI * 10 * 1000));

    })();
  </script>

</body>
</html>
