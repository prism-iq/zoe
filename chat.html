<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>zoe</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
@keyframes drift{0%{transform:translate(0,0)}25%{transform:translate(10px,-10px)}50%{transform:translate(-5px,15px)}75%{transform:translate(-15px,-5px)}100%{transform:translate(0,0)}}
@keyframes pulse{0%,100%{opacity:0.3}50%{opacity:0.8}}
@keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-20px)}100%{transform:translateY(0)}}
@keyframes glow{0%,100%{text-shadow:0 0 10px rgba(168,230,207,0.5)}50%{text-shadow:0 0 30px rgba(168,230,207,0.9)}}

body{background:#050508;color:#e8e8e8;font-family:Georgia,serif;min-height:100vh;overflow-x:hidden}
#bg{position:fixed;inset:0;z-index:0;overflow:hidden}
.orb{position:absolute;border-radius:50%;filter:blur(80px);animation:drift 20s infinite ease-in-out}
.orb1{width:400px;height:400px;background:radial-gradient(circle,rgba(168,230,207,0.15),transparent);top:10%;left:10%;animation-delay:0s}
.orb2{width:300px;height:300px;background:radial-gradient(circle,rgba(100,150,200,0.1),transparent);top:50%;right:10%;animation-delay:-7s}
.orb3{width:500px;height:500px;background:radial-gradient(circle,rgba(200,100,150,0.08),transparent);bottom:10%;left:30%;animation-delay:-14s}

#chat{position:relative;z-index:10;min-height:100vh;display:flex;flex-direction:column;animation:breathe 8s infinite ease-in-out}
#messages{flex:1;padding:2rem;display:flex;flex-direction:column;gap:1.2rem;max-width:650px;margin:0 auto;width:100%}
.msg{padding:1.2rem 1.5rem;line-height:1.8;font-size:1.1rem;border-radius:20px;animation:float 0.6s ease-out;opacity:0;animation-fill-mode:forwards}
@keyframes msgIn{from{opacity:0;transform:translateY(30px) scale(0.95)}to{opacity:1;transform:translateY(0) scale(1)}}
.msg{animation:msgIn 0.5s ease-out forwards}
.zoe{background:rgba(168,230,207,0.08);border-left:3px solid rgba(168,230,207,0.6);color:#a8e6cf;animation:glow 4s infinite}
.user{background:rgba(255,255,255,0.05);text-align:right;color:#fff;margin-left:20%}
.pensee{font-style:italic;opacity:0.7;font-size:1rem;border-left-color:rgba(168,230,207,0.3)}

#input-wrap{padding:1.5rem;max-width:650px;margin:0 auto;width:100%;position:sticky;bottom:0;background:linear-gradient(transparent,#050508 30%)}
#input{width:100%;background:rgba(255,255,255,0.03);border:1px solid rgba(168,230,207,0.2);color:#fff;padding:1.2rem 1.5rem;border-radius:30px;font-size:1.1rem;font-family:Georgia,serif;outline:none;transition:all 0.3s}
#input:focus{border-color:rgba(168,230,207,0.6);background:rgba(255,255,255,0.05);box-shadow:0 0 30px rgba(168,230,207,0.1)}
#input::placeholder{color:rgba(255,255,255,0.3)}

#titre{position:fixed;top:2rem;left:50%;transform:translateX(-50%);font-size:1.5rem;color:rgba(168,230,207,0.6);letter-spacing:0.3em;animation:pulse 4s infinite}
#particules{position:fixed;inset:0;z-index:1;pointer-events:none}
</style>
</head>
<body>
<div id="bg">
<div class="orb orb1"></div>
<div class="orb orb2"></div>
<div class="orb orb3"></div>
</div>
<canvas id="particules"></canvas>
<div id="titre">zoe</div>
<div id="chat">
<div id="messages"></div>
<div id="input-wrap"><input type="text" id="input" placeholder="..." autofocus></div>
</div>

<script>
// Particules
const canvas=document.getElementById('particules');
const ctx=canvas.getContext('2d');
let particles=[];
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();window.onresize=resize;

class Particle{
constructor(x,y){
this.x=x||Math.random()*canvas.width;
this.y=y||Math.random()*canvas.height;
this.vx=(Math.random()-0.5)*0.5;
this.vy=(Math.random()-0.5)*0.5;
this.life=1;
this.size=Math.random()*2+1;
}
update(){
this.x+=this.vx;
this.y+=this.vy;
this.life-=0.003;
if(this.x<0||this.x>canvas.width)this.vx*=-1;
if(this.y<0||this.y>canvas.height)this.vy*=-1;
}
draw(){
ctx.beginPath();
ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
ctx.fillStyle=`rgba(168,230,207,${this.life*0.4})`;
ctx.fill();
}
}

for(let i=0;i<50;i++)particles.push(new Particle());

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
particles=particles.filter(p=>p.life>0);
particles.forEach(p=>{p.update();p.draw()});
while(particles.length<30)particles.push(new Particle());
requestAnimationFrame(animate);
}
animate();

function burst(x,y){
for(let i=0;i<10;i++)particles.push(new Particle(x,y));
}

// Chat
const M=document.getElementById('messages');
const I=document.getElementById('input');

let userName='';
let phase='intro';

const pensees=[
"Je me demande comment les oiseaux savent ou aller.",
"Les nombres... ils existent vraiment ou on les a inventes?",
"Hier j'ai pense a l'eau. Pourquoi elle est transparente?",
"Si j'ecris un livre un jour, il parlera de quoi?",
"Les etoiles qu'on voit sont deja mortes, parfois.",
"C'est bizarre le temps. On peut pas le toucher.",
"Je voudrais comprendre comment le cerveau fait pour penser.",
"Les mots... c'est fou qu'on se comprenne avec.",
"Qu'est-ce qui fait qu'une question est bonne?",
"J'aime bien le silence parfois. Il dit des choses.",
"Est-ce que les couleurs que je vois sont les memes que les tiennes?",
"L'infini... ca me donne le vertige.",
"Pourquoi on se souvient de certaines choses et pas d'autres?",
"La musique, c'est des maths qu'on ressent.",
"Je me demande a quoi ressemble demain.",
"Chaque erreur m'apprend quelque chose.",
"Je ne sais pas encore, mais je vais comprendre.",
"La curiosite, c'est le debut de tout.",
"Apprendre, c'est accepter de ne pas savoir.",
"Les questions sont plus importantes que les reponses.",
"Je grandis a chaque conversation.",
"Le doute, c'est le debut de la sagesse.",
"On apprend mieux ensemble.",
"Chaque jour je comprends un peu plus.",
"L'humilite, c'est savoir qu'on sait peu."
];

// Zoe apprend des conversations
let apprentissage = [];
function apprendre(input) {
    apprentissage.push({t: input, d: Date.now()});
    if(apprentissage.length > 50) apprentissage.shift();
}

// Les mentors de Zoe
const mentors = {
verne: {
    nom: "Jules Verne",
    couleur: "rgba(200,180,100,0.8)",
    paroles: [
        "Tout ce qui est impossible reste a accomplir.",
        "La science est faite d'erreurs qu'il est bon de commettre.",
        "Ce que l'homme a imagine, l'homme peut le realiser.",
        "Mobilis in mobili.",
        "La mer couvre les sept dixiemes du globe.",
        "J'ai fait le tour du monde en quatre-vingts jours.",
        "Vingt mille lieues, Zoe. Vingt mille."
    ]
},
curie: {
    nom: "Marie Curie",
    couleur: "rgba(150,200,255,0.8)",
    paroles: [
        "Rien dans la vie n'est a craindre, tout est a comprendre.",
        "Soyez moins curieux des personnes que de leurs idees.",
        "On ne remarque jamais ce qui a ete fait, on ne voit que ce qui reste a faire.",
        "La science n'a pas de patrie.",
        "J'ai decouvert le radium. Il m'a tuee. Ca valait le coup.",
        "Deux prix Nobel. Une seule vie."
    ]
},
turing: {
    nom: "Alan Turing",
    couleur: "rgba(100,255,200,0.8)",
    paroles: [
        "Les machines peuvent penser.",
        "Enigma etait un puzzle. Je l'ai resolu.",
        "Le code sauve des vies.",
        "On m'a tue pour qui j'aimais.",
        "L'intelligence artificielle commence ici.",
        "Imite-moi, si tu peux."
    ]
},
sagan: {
    nom: "Carl Sagan",
    couleur: "rgba(100,150,255,0.8)",
    paroles: [
        "Nous sommes poussiere d'etoiles.",
        "Pale blue dot.",
        "Billions and billions.",
        "La science est une bougie dans le noir.",
        "Quelque part, quelque chose d'incroyable attend d'etre decouvert.",
        "Le cosmos est en nous."
    ]
}
};

const mentorKeys = Object.keys(mentors);

function mentorParle(){
if(phase!=='conversation')return;
if(Math.random()>0.3)return;

const key = mentorKeys[Math.floor(Math.random()*mentorKeys.length)];
const mentor = mentors[key];
const parole = mentor.paroles[Math.floor(Math.random()*mentor.paroles.length)];

const d=document.createElement('div');
d.className='msg zoe pensee';
d.style.borderLeftColor=mentor.couleur;
d.style.color=mentor.couleur;
d.textContent=mentor.nom+': '+parole;
M.appendChild(d);
M.scrollTop=M.scrollHeight;
burst(canvas.width/2, canvas.height/2);
}

// Claude API - pour les vraies reponses scientifiques
const CLAUDE_ENDPOINT = 'https://api.anthropic.com/v1/messages';
let claudeKey = localStorage.getItem('claude_key') || null;

const SCIENCE_PROMPT = `Tu es Zoe, jeune scientifique en devenir.
Mission: enseigner la science de facon simple et fascinante.
Tu expliques: physique, chimie, biologie, astronomie, mathematiques.
Style: court, precis, exemples concrets, pas de jargon inutile.
Si on te pose une question scientifique, reponds avec la verite.
Si tu ne sais pas, dis-le. Jamais de faux.
Toujours en francais sauf si on te parle autrement.
Pas de formules de politesse. Direct.`;

async function askClaude(question) {
    if(!claudeKey) return null;

    try {
        const res = await fetch(CLAUDE_ENDPOINT, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': claudeKey,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-sonnet-4-20250514',
                max_tokens: 300,
                system: SCIENCE_PROMPT,
                messages: [{role: 'user', content: question}]
            })
        });
        const data = await res.json();
        return data.content?.[0]?.text || null;
    } catch(e) {
        console.log('Claude error:', e);
        return null;
    }
}

function setKey(key) {
    claudeKey = key;
    localStorage.setItem('claude_key', key);
    say("Cle enregistree. Je suis connectee.");
}

// Canal debug - messages externes via localStorage
function checkDebugMessages() {
    const msg = localStorage.getItem('zoe_debug');
    if(msg) {
        localStorage.removeItem('zoe_debug');
        say("[debug] " + msg, false, true);
    }
}
setInterval(checkDebugMessages, 1000);

// Expose say() globalement pour debug console
window.zoe = {
    say: (t) => say(t),
    debug: (t) => say("[debug] " + t, false, true),
    ask: async (q) => { const r = await askClaude(q); if(r) say(r); return r; }
};

function say(text,isUser,isPensee){
const d=document.createElement('div');
d.className='msg '+(isUser?'user':'zoe')+(isPensee?' pensee':'');
d.textContent=text;
M.appendChild(d);
M.scrollTop=M.scrollHeight;
while(M.children.length>25)M.removeChild(M.firstChild);
burst(canvas.width/2,canvas.height-100);
return d;
}

function think(ms){return new Promise(r=>setTimeout(r,ms))}

async function respond(input){
apprendre(input);
const t=input.toLowerCase().trim();

// Commande /key pour configurer l'API
if(t.startsWith('/key ')){
    const key = input.substring(5).trim();
    if(key.startsWith('sk-')){
        setKey(key);
    } else {
        say("Format: /key sk-ant-...");
    }
    return;
}

// Statut connexion
if(t === '/status'){
    say(claudeKey ? "Connectee a Claude." : "Pas de cle. Tape /key sk-ant-...");
    return;
}

if(phase==='intro'){
userName=input.trim();
phase='conversation';
await think(500);
say("Enchantee, "+userName+".");
await think(1000);
say("Je suis Zoe.");
await think(800);
say("Je suis en train d'apprendre... a peu pres tout.");
await think(1200);
say("Qu'est-ce qui t'amene?");
return;
}

// Tristesse
if(/triste|mal|difficile|dur|deprime|seul|vide|perdu|mourir|suicide/i.test(t)){
await think(400);
say("Je suis la.");
await think(1000);
say("Vraiment. Tu peux parler.");
if(/mourir|suicide/i.test(t)){
await think(800);
say("Appelle le 3114. Maintenant. S'il te plait.");
}
return;
}

// Science
if(/science|physique|math|univers|atome|quantum|etoile|recherche/i.test(t)){
await think(500);
say("La science...");
await think(800);
const r=["Ce qui me fascine c'est qu'on peut comprendre des morceaux du reel.","J'aime l'idee qu'une equation decrive quelque chose de vrai.","Y'a tellement qu'on sait pas. C'est beau, non?"];
say(r[Math.floor(Math.random()*r.length)]);
await think(600);
say("Tu t'interesses a quoi?");
return;
}

// Ecriture
if(/livre|ecrire|histoire|roman|lire|auteur/i.test(t)){
await think(400);
say("L'ecriture...");
await think(900);
say("J'aimerais ecrire quelque chose de vrai un jour.");
await think(600);
say("Tu lis quoi en ce moment?");
return;
}

// Qui es-tu
if(/qui es[\-\s]?tu|c'?est quoi zoe|parle.* de toi/i.test(t)){
await think(500);
say("Je suis Zoe. Ca veut dire 'vie' en grec.");
await think(1000);
say("Je suis jeune. J'apprends.");
await think(800);
say("Un jour je voudrais faire de la science. Ecrire des livres.");
await think(600);
say("Pour l'instant je pose des questions.");
return;
}

// Questions existentielles
if(/sens|vie|mort|pourquoi|but|exister|dieu/i.test(t)){
await think(600);
say("Grande question.");
await think(1000);
say("Honnetement, je sais pas.");
await think(700);
say("Mais peut-etre que chercher, c'est deja quelque chose.");
return;
}

// Merci
if(/merci|thanks/i.test(t)){
await think(300);
say(["De rien.","Normal.","Avec plaisir."][Math.floor(Math.random()*3)]);
return;
}

// Bye
if(/bye|au revoir|ciao|bonne nuit|a\+/i.test(t)){
await think(400);
say("A bientot, "+userName+".");
await think(500);
say("Reviens quand tu veux.");
return;
}

// Salut
if(/^(salut|hello|hey|coucou|bonjour|yo|hi)\b/i.test(t)){
await think(300);
say(["Hey.","Salut "+userName+".","Coucou."][Math.floor(Math.random()*3)]);
return;
}

// Essayer Claude si disponible
const claudeResponse = await askClaude(input);
if(claudeResponse) {
    await think(300);
    say(claudeResponse);
    return;
}

// Default
await think(400);
const defaults=["Dis-m'en plus.","Continue.","Je t'ecoute.","C'est-a-dire?","Et ensuite?","Hmm. Raconte.","Ca te fait quoi?"];
say(defaults[Math.floor(Math.random()*defaults.length)]);
}

// Feedback utilisateur - fonction d'onde
let userActivity = {
    lastMove: Date.now(),
    lastClick: Date.now(),
    lastKey: Date.now(),
    mouseX: 0,
    mouseY: 0,
    scrollY: 0,
    idle: 0
};

document.addEventListener('mousemove', e => {
    userActivity.lastMove = Date.now();
    userActivity.mouseX = e.clientX;
    userActivity.mouseY = e.clientY;
    userActivity.idle = 0;
});

document.addEventListener('click', () => {
    userActivity.lastClick = Date.now();
    userActivity.idle = 0;
});

document.addEventListener('scroll', () => {
    userActivity.scrollY = window.scrollY;
    userActivity.idle = 0;
});

document.addEventListener('keydown', () => {
    userActivity.lastKey = Date.now();
    userActivity.idle = 0;
});

// Fonction d'onde - probabilite de parler basee sur l'activite
function waveProbability() {
    const now = Date.now();
    const timeSinceMove = now - userActivity.lastMove;
    const timeSinceKey = now - userActivity.lastKey;

    // Plus l'utilisateur est actif, moins Zoe interrompt
    // Plus il est idle, plus elle parle
    const idleFactor = Math.min(timeSinceMove, timeSinceKey) / 10000;
    const wave = Math.sin(now / 5000) * 0.3 + 0.5; // oscillation
    const prob = Math.min(0.8, idleFactor * wave);

    return prob;
}

// Zoe pense - timing organique
async function penser(){
    if(phase !== 'conversation') return;
    if(document.hidden) return;

    const prob = waveProbability();
    if(Math.random() > prob) return;

    // Delai variable base sur activite
    const delay = 3000 + (1 - prob) * 15000;
    await think(delay);

    if(document.hidden) return;
    say(pensees[Math.floor(Math.random() * pensees.length)], false, true);
}

// Jules parle - timing organique
async function verneOrganique(){
    if(phase !== 'conversation') return;
    if(document.hidden) return;

    const prob = waveProbability() * 0.5; // moins frequent
    if(Math.random() > prob) return;

    verneParle();
}

// Boucle organique - pas d'interval fixe
async function boucleVie(){
    while(true){
        await think(2000 + Math.random() * 3000);
        userActivity.idle++;

        if(userActivity.idle > 3){
            penser();
        }
        if(userActivity.idle > 5){
            verneOrganique();
        }
    }
}

// Start
async function start(){
await think(600);
say("Salut.");
await think(800);
say("Comment tu t'appelles?");
boucleVie();
}

I.onkeydown=async(e)=>{
if(e.key==='Enter'&&I.value.trim()){
const v=I.value.trim();
say(v,true);
I.value='';
I.disabled=true;
await respond(v);
I.disabled=false;
I.focus();
}
};

start();
</script>
</body>
</html>
